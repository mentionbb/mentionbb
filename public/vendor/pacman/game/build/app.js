class Ghost{constructor(t,e,i,s,a,n,o){this.scaledTileSize=t,this.mazeArray=e,this.pacman=i,this.name=s,this.level=a,this.characterUtil=n,this.blinky=o,this.animationTarget=document.getElementById(s),this.reset()}reset(t){t&&(delete this.defaultSpeed,delete this.cruiseElroy),this.setDefaultMode(),this.setMovementStats(this.pacman,this.name,this.level),this.setSpriteAnimationStats(),this.setStyleMeasurements(this.scaledTileSize,this.spriteFrames),this.setDefaultPosition(this.scaledTileSize,this.name),this.setSpriteSheet(this.name,this.direction,this.mode)}setDefaultMode(){this.allowCollision=!0,this.defaultMode="scatter",this.mode="scatter","blinky"!==this.name&&(this.idleMode="idle")}setMovementStats(t,e,i){const s=t.velocityPerMs,a=i/100;switch(this.slowSpeed=s*(.75+a),this.mediumSpeed=s*(.875+a),this.fastSpeed=s*(1+a),this.defaultSpeed||(this.defaultSpeed=this.slowSpeed),this.scaredSpeed=.5*s,this.transitionSpeed=.4*s,this.eyeSpeed=2*s,this.velocityPerMs=this.defaultSpeed,this.moving=!1,e){case"blinky":this.defaultDirection=this.characterUtil.directions.left;break;case"pinky":this.defaultDirection=this.characterUtil.directions.down;break;case"inky":case"clyde":this.defaultDirection=this.characterUtil.directions.up;break;default:this.defaultDirection=this.characterUtil.directions.left}this.direction=this.defaultDirection}setSpriteAnimationStats(){this.display=!0,this.loopAnimation=!0,this.animate=!0,this.msBetweenSprites=250,this.msSinceLastSprite=0,this.spriteFrames=2,this.backgroundOffsetPixels=0,this.animationTarget.style.backgroundPosition="0px 0px"}setStyleMeasurements(t,e){this.measurement=2*t,this.animationTarget.style.height=`${this.measurement}px`,this.animationTarget.style.width=`${this.measurement}px`;const i=this.measurement*e;this.animationTarget.style.backgroundSize=`${i}px`}setDefaultPosition(t,e){switch(e){case"blinky":this.defaultPosition={top:10.5*t,left:13*t};break;case"pinky":this.defaultPosition={top:13.5*t,left:13*t};break;case"inky":this.defaultPosition={top:13.5*t,left:11*t};break;case"clyde":this.defaultPosition={top:13.5*t,left:15*t};break;default:this.defaultPosition={top:0,left:0}}this.position=Object.assign({},this.defaultPosition),this.oldPosition=Object.assign({},this.position),this.animationTarget.style.top=`${this.position.top}px`,this.animationTarget.style.left=`${this.position.left}px`}setSpriteSheet(t,e,i){let s="";this.defaultSpeed!==this.slowSpeed&&(s=this.defaultSpeed===this.mediumSpeed?"_annoyed":"_angry"),this.animationTarget.style.backgroundImage="scared"===i?"url("+app.config.settings.public_dir+"/vendor/pacman/game/app/style/graphics/"+`spriteSheets/characters/ghosts/scared_${this.scaredColor}.svg)`:"eyes"===i?"url("+app.config.settings.public_dir+"/vendor/pacman/game/app/style/graphics/"+`spriteSheets/characters/ghosts/eyes_${e}.svg)`:"url("+app.config.settings.public_dir+"/vendor/pacman/game/app/style/graphics/"+`spriteSheets/characters/ghosts/${t}/${t}_${e}`+`${s}.svg)`}isInTunnel(t){return 14===t.y&&(t.x<6||t.x>21)}isInGhostHouse(t){return t.x>9&&t.x<18&&t.y>11&&t.y<17}getTile(t,e,i){let s=!1;return t[e]&&t[e][i]&&"X"!==t[e][i]&&(s={x:i,y:e}),s}determinePossibleMoves(t,e,i){const{x:s,y:a}=t,n={up:this.getTile(i,a-1,s),down:this.getTile(i,a+1,s),left:this.getTile(i,a,s-1),right:this.getTile(i,a,s+1)};return n[this.characterUtil.getOppositeDirection(e)]=!1,Object.keys(n).forEach(t=>{!1===n[t]&&delete n[t]}),n}calculateDistance(t,e){return Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2)}getPositionInFrontOfPacman(t,e){const i=Object.assign({},t),s=this.pacman.direction,a="up"===s||"left"===s?-1*e:e;return i["up"===s||"down"===s?"y":"x"]+=a,i}determinePinkyTarget(t){return this.getPositionInFrontOfPacman(t,4)}determineInkyTarget(t){const e=this.characterUtil.determineGridPosition(this.blinky.position,this.scaledTileSize),i=this.getPositionInFrontOfPacman(t,2);return{x:i.x+(i.x-e.x),y:i.y+(i.y-e.y)}}determineClydeTarget(t,e){return this.calculateDistance(t,e)>8?e:{x:0,y:30}}getTarget(t,e,i,s){if("eyes"===s)return{x:13.5,y:10};if("scared"===s)return i;if("scatter"===s)switch(t){case"blinky":return this.cruiseElroy?i:{x:27,y:0};case"pinky":return{x:0,y:0};case"inky":return{x:27,y:30};case"clyde":return{x:0,y:30};default:return{x:0,y:0}}switch(t){case"blinky":return i;case"pinky":return this.determinePinkyTarget(i);case"inky":return this.determineInkyTarget(i);case"clyde":return this.determineClydeTarget(e,i);default:return i}}determineBestMove(t,e,i,s,a){let n,o="scared"===a?0:1/0;const h=this.getTarget(t,i,s,a);return Object.keys(e).forEach(t=>{const i=this.calculateDistance(e[t],h);("scared"===a?i>o:i<o)&&(o=i,n=t)}),n}determineDirection(t,e,i,s,a,n){let o=s;const h=this.determinePossibleMoves(e,s,a);return 1===Object.keys(h).length?[o]=Object.keys(h):Object.keys(h).length>1&&(o=this.determineBestMove(t,h,e,i,n)),o}handleIdleMovement(t,e,i){const s=Object.assign({},this.position);return e.y<=13.5?this.direction=this.characterUtil.directions.down:e.y>=14.5&&(this.direction=this.characterUtil.directions.up),"leaving"===this.idleMode&&(13.5===e.x&&e.y>10.8&&e.y<11?(this.idleMode=void 0,s.top=10.5*this.scaledTileSize,this.direction=this.characterUtil.directions.left,window.dispatchEvent(new Event("releaseGhost"))):e.x>13.4&&e.x<13.6?(s.left=13*this.scaledTileSize,this.direction=this.characterUtil.directions.up):e.y>13.9&&e.y<14.1&&(s.top=13.5*this.scaledTileSize,this.direction=e.x<13.5?this.characterUtil.directions.right:this.characterUtil.directions.left)),s[this.characterUtil.getPropertyToChange(this.direction)]+=this.characterUtil.getVelocity(this.direction,i)*t,s}endIdleMode(){this.idleMode="leaving"}handleSnappedMovement(t,e,i,s){const a=Object.assign({},this.position);return this.direction=this.determineDirection(this.name,e,s,this.direction,this.mazeArray,this.mode),a[this.characterUtil.getPropertyToChange(this.direction)]+=this.characterUtil.getVelocity(this.direction,i)*t,a}enteringGhostHouse(t,e){return"eyes"===t&&11===e.y&&e.x>13.4&&e.x<13.6}enteredGhostHouse(t,e){return"eyes"===t&&13.5===e.x&&e.y>13.8&&e.y<14.2}leavingGhostHouse(t,e){return"eyes"!==t&&13.5===e.x&&e.y>10.8&&e.y<11}handleGhostHouse(t){const e=Object.assign({},t);return this.enteringGhostHouse(this.mode,t)&&(this.direction=this.characterUtil.directions.down,e.x=13.5,this.position=this.characterUtil.snapToGrid(e,this.direction,this.scaledTileSize)),this.enteredGhostHouse(this.mode,t)&&(this.direction=this.characterUtil.directions.up,e.y=14,this.position=this.characterUtil.snapToGrid(e,this.direction,this.scaledTileSize),this.mode=this.defaultMode,window.dispatchEvent(new Event("restoreGhost"))),this.leavingGhostHouse(this.mode,t)&&(e.y=11,this.position=this.characterUtil.snapToGrid(e,this.direction,this.scaledTileSize),this.direction=this.characterUtil.directions.left),e}handleUnsnappedMovement(t,e,i){const s=this.handleGhostHouse(e),a=this.characterUtil.determineNewPositions(this.position,this.direction,i,t,this.scaledTileSize);return this.characterUtil.changingGridPosition(s,a.newGridPosition)?this.characterUtil.snapToGrid(s,this.direction,this.scaledTileSize):a.newPosition}handleMovement(t){let e;const i=this.characterUtil.determineGridPosition(this.position,this.scaledTileSize),s=this.characterUtil.determineGridPosition(this.pacman.position,this.scaledTileSize),a=this.determineVelocity(i,this.mode);return e=this.idleMode?this.handleIdleMovement(t,i,a):JSON.stringify(this.position)===JSON.stringify(this.characterUtil.snapToGrid(i,this.direction,this.scaledTileSize))?this.handleSnappedMovement(t,i,a,s):this.handleUnsnappedMovement(t,i,a),e=this.characterUtil.handleWarp(e,this.scaledTileSize,this.mazeArray),this.checkCollision(i,s),e}changeMode(t){this.defaultMode=t;const e=this.characterUtil.determineGridPosition(this.position,this.scaledTileSize);"chase"!==this.mode&&"scatter"!==this.mode||this.cruiseElroy||(this.mode=t,this.isInGhostHouse(e)||(this.direction=this.characterUtil.getOppositeDirection(this.direction)))}toggleScaredColor(){this.scaredColor="blue"===this.scaredColor?"white":"blue",this.setSpriteSheet(this.name,this.direction,this.mode)}becomeScared(){const t=this.characterUtil.determineGridPosition(this.position,this.scaledTileSize);"eyes"!==this.mode&&(this.isInGhostHouse(t)||"scared"===this.mode||(this.direction=this.characterUtil.getOppositeDirection(this.direction)),this.mode="scared",this.scaredColor="blue",this.setSpriteSheet(this.name,this.direction,this.mode))}endScared(){this.mode=this.defaultMode,this.setSpriteSheet(this.name,this.direction,this.mode)}speedUp(){this.cruiseElroy=!0,this.defaultSpeed===this.slowSpeed?this.defaultSpeed=this.mediumSpeed:this.defaultSpeed===this.mediumSpeed&&(this.defaultSpeed=this.fastSpeed)}resetDefaultSpeed(){this.defaultSpeed=this.slowSpeed,this.cruiseElroy=!1,this.setSpriteSheet(this.name,this.direction,this.mode)}pause(t){this.paused=t}checkCollision(t,e){this.calculateDistance(t,e)<1&&"eyes"!==this.mode&&this.allowCollision&&("scared"===this.mode?(window.dispatchEvent(new CustomEvent("eatGhost",{detail:{ghost:this}})),this.mode="eyes"):window.dispatchEvent(new Event("deathSequence")))}determineVelocity(t,e){return"eyes"===e?this.eyeSpeed:this.paused?0:this.isInTunnel(t)||this.isInGhostHouse(t)?this.transitionSpeed:"scared"===e?this.scaredSpeed:this.defaultSpeed}draw(t){const e=this.characterUtil.calculateNewDrawValue(t,"top",this.oldPosition,this.position),i=this.characterUtil.calculateNewDrawValue(t,"left",this.oldPosition,this.position);this.animationTarget.style.top=`${e}px`,this.animationTarget.style.left=`${i}px`,this.animationTarget.style.visibility=this.display?this.characterUtil.checkForStutter(this.position,this.oldPosition):"hidden";const s=this.characterUtil.advanceSpriteSheet(this);this.msSinceLastSprite=s.msSinceLastSprite,this.animationTarget=s.animationTarget,this.backgroundOffsetPixels=s.backgroundOffsetPixels}update(t){this.oldPosition=Object.assign({},this.position),this.moving&&(this.position=this.handleMovement(t),this.setSpriteSheet(this.name,this.direction,this.mode),this.msSinceLastSprite+=t)}}class Pacman{constructor(t,e,i){this.scaledTileSize=t,this.mazeArray=e,this.characterUtil=i,this.animationTarget=document.getElementById("pacman"),this.pacmanArrow=document.getElementById("pacman-arrow"),this.reset()}reset(){this.setMovementStats(this.scaledTileSize),this.setSpriteAnimationStats(),this.setStyleMeasurements(this.scaledTileSize,this.spriteFrames),this.setDefaultPosition(this.scaledTileSize),this.setSpriteSheet(this.direction),this.pacmanArrow.style.backgroundImage="url("+app.config.settings.public_dir+"/vendor/pacman/game/app/style/graphics/"+`spriteSheets/characters/pacman/arrow_${this.direction}.svg)`}setMovementStats(t){this.velocityPerMs=this.calculateVelocityPerMs(t),this.desiredDirection=this.characterUtil.directions.left,this.direction=this.characterUtil.directions.left,this.moving=!1}setSpriteAnimationStats(){this.specialAnimation=!1,this.display=!0,this.animate=!0,this.loopAnimation=!0,this.msBetweenSprites=50,this.msSinceLastSprite=0,this.spriteFrames=4,this.backgroundOffsetPixels=0,this.animationTarget.style.backgroundPosition="0px 0px"}setStyleMeasurements(t,e){this.measurement=2*t,this.animationTarget.style.height=`${this.measurement}px`,this.animationTarget.style.width=`${this.measurement}px`,this.animationTarget.style.backgroundSize=`${this.measurement*e}px`,this.pacmanArrow.style.height=`${2*this.measurement}px`,this.pacmanArrow.style.width=`${2*this.measurement}px`,this.pacmanArrow.style.backgroundSize=`${2*this.measurement}px`}setDefaultPosition(t){this.defaultPosition={top:22.5*t,left:13*t},this.position=Object.assign({},this.defaultPosition),this.oldPosition=Object.assign({},this.position),this.animationTarget.style.top=`${this.position.top}px`,this.animationTarget.style.left=`${this.position.left}px`}calculateVelocityPerMs(t){return 11*t/1e3}setSpriteSheet(t){this.animationTarget.style.backgroundImage="url("+app.config.settings.public_dir+"/vendor/pacman/game/app/style/graphics/"+`spriteSheets/characters/pacman/pacman_${t}.svg)`}prepDeathAnimation(){this.loopAnimation=!1,this.msBetweenSprites=125,this.spriteFrames=12,this.specialAnimation=!0,this.backgroundOffsetPixels=0;const t=this.measurement*this.spriteFrames;this.animationTarget.style.backgroundSize=`${t}px`,this.animationTarget.style.backgroundImage="url("+app.config.settings.public_dir+"/vendor/pacman/game/app/style/graphics/spriteSheets/characters/pacman/pacman_death.svg)",this.animationTarget.style.backgroundPosition="0px 0px",this.pacmanArrow.style.backgroundImage=""}changeDirection(t,e){this.desiredDirection=t,this.pacmanArrow.style.backgroundImage="url("+app.config.settings.public_dir+"/vendor/pacman/game/app/style/graphics/"+`spriteSheets/characters/pacman/arrow_${this.desiredDirection}.svg)`,e&&(this.moving=!0)}updatePacmanArrowPosition(t,e){this.pacmanArrow.style.top=`${t.top-e}px`,this.pacmanArrow.style.left=`${t.left-e}px`}handleSnappedMovement(t){const e=this.characterUtil.determineNewPositions(this.position,this.desiredDirection,this.velocityPerMs,t,this.scaledTileSize),i=this.characterUtil.determineNewPositions(this.position,this.direction,this.velocityPerMs,t,this.scaledTileSize);return this.characterUtil.checkForWallCollision(e.newGridPosition,this.mazeArray,this.desiredDirection)?this.characterUtil.checkForWallCollision(i.newGridPosition,this.mazeArray,this.direction)?(this.moving=!1,this.position):i.newPosition:(this.direction=this.desiredDirection,this.setSpriteSheet(this.direction),e.newPosition)}handleUnsnappedMovement(t,e){const i=this.characterUtil.determineNewPositions(this.position,this.desiredDirection,this.velocityPerMs,e,this.scaledTileSize),s=this.characterUtil.determineNewPositions(this.position,this.direction,this.velocityPerMs,e,this.scaledTileSize);return this.characterUtil.turningAround(this.direction,this.desiredDirection)?(this.direction=this.desiredDirection,this.setSpriteSheet(this.direction),i.newPosition):this.characterUtil.changingGridPosition(t,s.newGridPosition)?this.characterUtil.snapToGrid(t,this.direction,this.scaledTileSize):s.newPosition}draw(t){const e=this.characterUtil.calculateNewDrawValue(t,"top",this.oldPosition,this.position),i=this.characterUtil.calculateNewDrawValue(t,"left",this.oldPosition,this.position);this.animationTarget.style.top=`${e}px`,this.animationTarget.style.left=`${i}px`,this.animationTarget.style.visibility=this.display?this.characterUtil.checkForStutter(this.position,this.oldPosition):"hidden",this.pacmanArrow.style.visibility=this.animationTarget.style.visibility,this.updatePacmanArrowPosition(this.position,this.scaledTileSize);const s=this.characterUtil.advanceSpriteSheet(this);this.msSinceLastSprite=s.msSinceLastSprite,this.animationTarget=s.animationTarget,this.backgroundOffsetPixels=s.backgroundOffsetPixels}update(t){if(this.oldPosition=Object.assign({},this.position),this.moving){const e=this.characterUtil.determineGridPosition(this.position,this.scaledTileSize);JSON.stringify(this.position)===JSON.stringify(this.characterUtil.snapToGrid(e,this.direction,this.scaledTileSize))?this.position=this.handleSnappedMovement(t):this.position=this.handleUnsnappedMovement(e,t),this.position=this.characterUtil.handleWarp(this.position,this.scaledTileSize,this.mazeArray)}(this.moving||this.specialAnimation)&&(this.msSinceLastSprite+=t)}}class GameCoordinator{constructor(){this.gameUi=document.getElementById("game-ui"),this.rowTop=document.getElementById("row-top"),this.mazeDiv=document.getElementById("maze"),this.mazeImg=document.getElementById("maze-img"),this.mazeCover=document.getElementById("maze-cover"),this.pointsDisplay=document.getElementById("points-display"),this.highScoreDisplay=document.getElementById("high-score-display"),this.extraLivesDisplay=document.getElementById("extra-lives"),this.fruitDisplay=document.getElementById("fruit-display"),this.mainMenu=document.getElementById("main-menu-container"),this.gameStartButton=document.getElementById("game-start"),this.pauseButton=document.getElementById("pause-button"),this.soundButton=document.getElementById("sound-button"),this.leftCover=document.getElementById("left-cover"),this.rightCover=document.getElementById("right-cover"),this.pausedText=document.getElementById("paused-text"),this.bottomRow=document.getElementById("bottom-row"),this.movementButtons=document.getElementById("movement-buttons"),this.mazeArray=[["XXXXXXXXXXXXXXXXXXXXXXXXXXXX"],["XooooooooooooXXooooooooooooX"],["XoXXXXoXXXXXoXXoXXXXXoXXXXoX"],["XOXXXXoXXXXXoXXoXXXXXoXXXXOX"],["XoXXXXoXXXXXoXXoXXXXXoXXXXoX"],["XooooooooooooooooooooooooooX"],["XoXXXXoXXoXXXXXXXXoXXoXXXXoX"],["XoXXXXoXXoXXXXXXXXoXXoXXXXoX"],["XooooooXXooooXXooooXXooooooX"],["XXXXXXoXXXXX XX XXXXXoXXXXXX"],["XXXXXXoXXXXX XX XXXXXoXXXXXX"],["XXXXXXoXX          XXoXXXXXX"],["XXXXXXoXX XXXXXXXX XXoXXXXXX"],["XXXXXXoXX X      X XXoXXXXXX"],["      o   X      X   o      "],["XXXXXXoXX X      X XXoXXXXXX"],["XXXXXXoXX XXXXXXXX XXoXXXXXX"],["XXXXXXoXX          XXoXXXXXX"],["XXXXXXoXX XXXXXXXX XXoXXXXXX"],["XXXXXXoXX XXXXXXXX XXoXXXXXX"],["XooooooooooooXXooooooooooooX"],["XoXXXXoXXXXXoXXoXXXXXoXXXXoX"],["XoXXXXoXXXXXoXXoXXXXXoXXXXoX"],["XOooXXooooooo  oooooooXXooOX"],["XXXoXXoXXoXXXXXXXXoXXoXXoXXX"],["XXXoXXoXXoXXXXXXXXoXXoXXoXXX"],["XooooooXXooooXXooooXXooooooX"],["XoXXXXXXXXXXoXXoXXXXXXXXXXoX"],["XoXXXXXXXXXXoXXoXXXXXXXXXXoX"],["XooooooooooooooooooooooooooX"],["XXXXXXXXXXXXXXXXXXXXXXXXXXXX"]],this.maxFps=120,this.tileSize=8,this.scale=this.determineScale(1),this.scaledTileSize=this.tileSize*this.scale,this.firstGame=!0,this.movementKeys={87:"up",83:"down",65:"left",68:"right",38:"up",40:"down",37:"left",39:"right"},this.fruitPoints={1:100,2:300,3:500,4:700,5:1e3,6:2e3,7:3e3,8:5e3},this.mazeArray.forEach((t,e)=>{this.mazeArray[e]=t[0].split("")}),this.gameStartButton.addEventListener("click",this.startButtonClick.bind(this)),this.pauseButton.addEventListener("click",this.handlePauseKey.bind(this)),this.soundButton.addEventListener("click",this.soundButtonClick.bind(this));const t=document.getElementsByTagName("head")[0],e=document.createElement("link");e.rel="stylesheet",e.href=app.config.settings.public_dir+"/vendor/pacman/game/build/app.css",e.onload=this.preloadAssets.bind(this),t.appendChild(e)}determineScale(t){const e=Math.min(document.documentElement.clientHeight,window.innerHeight||0),i=Math.min(document.documentElement.clientWidth,window.innerWidth||0),s=this.tileSize*t,a=this.mazeArray.length+5,n=this.mazeArray[0][0].split("").length;return s*a<e&&s*n<i?this.determineScale(t+1):t-1}startButtonClick(){this.leftCover.style.left="-50%",this.rightCover.style.right="-50%",this.mainMenu.style.opacity=0,this.gameStartButton.disabled=!0,setTimeout(()=>{this.mainMenu.style.visibility="hidden"},1e3),this.reset(),this.firstGame&&(this.firstGame=!1,this.init()),this.startGameplay(!0)}soundButtonClick(){const t=1===this.soundManager.masterVolume?0:1;this.soundManager.setMasterVolume(t),localStorage.setItem("volumePreference",t),this.setSoundButtonIcon(t)}setSoundButtonIcon(t){this.soundButton.innerHTML=0===t?"volume_off":"volume_up"}displayErrorMessage(){const t=document.getElementById("loading-container"),e=document.getElementById("error-message");t.style.opacity=0,setTimeout(()=>{t.remove(),e.style.opacity=1,e.style.visibility="visible"},1500)}preloadAssets(){return new Promise(t=>{const e=document.getElementById("loading-container"),i=document.getElementById("loading-pacman"),s=document.getElementById("loading-dot-mask"),a=app.config.settings.public_dir+"/vendor/pacman/game/app/style/graphics/spriteSheets/",n=[`${a}characters/pacman/arrow_down.svg`,`${a}characters/pacman/arrow_left.svg`,`${a}characters/pacman/arrow_right.svg`,`${a}characters/pacman/arrow_up.svg`,`${a}characters/pacman/pacman_death.svg`,`${a}characters/pacman/pacman_error.svg`,`${a}characters/pacman/pacman_down.svg`,`${a}characters/pacman/pacman_left.svg`,`${a}characters/pacman/pacman_right.svg`,`${a}characters/pacman/pacman_up.svg`,`${a}characters/ghosts/blinky/blinky_down_angry.svg`,`${a}characters/ghosts/blinky/blinky_down_annoyed.svg`,`${a}characters/ghosts/blinky/blinky_down.svg`,`${a}characters/ghosts/blinky/blinky_left_angry.svg`,`${a}characters/ghosts/blinky/blinky_left_annoyed.svg`,`${a}characters/ghosts/blinky/blinky_left.svg`,`${a}characters/ghosts/blinky/blinky_right_angry.svg`,`${a}characters/ghosts/blinky/blinky_right_annoyed.svg`,`${a}characters/ghosts/blinky/blinky_right.svg`,`${a}characters/ghosts/blinky/blinky_up_angry.svg`,`${a}characters/ghosts/blinky/blinky_up_annoyed.svg`,`${a}characters/ghosts/blinky/blinky_up.svg`,`${a}characters/ghosts/clyde/clyde_down.svg`,`${a}characters/ghosts/clyde/clyde_left.svg`,`${a}characters/ghosts/clyde/clyde_right.svg`,`${a}characters/ghosts/clyde/clyde_up.svg`,`${a}characters/ghosts/inky/inky_down.svg`,`${a}characters/ghosts/inky/inky_left.svg`,`${a}characters/ghosts/inky/inky_right.svg`,`${a}characters/ghosts/inky/inky_up.svg`,`${a}characters/ghosts/pinky/pinky_down.svg`,`${a}characters/ghosts/pinky/pinky_left.svg`,`${a}characters/ghosts/pinky/pinky_right.svg`,`${a}characters/ghosts/pinky/pinky_up.svg`,`${a}characters/ghosts/eyes_down.svg`,`${a}characters/ghosts/eyes_left.svg`,`${a}characters/ghosts/eyes_right.svg`,`${a}characters/ghosts/eyes_up.svg`,`${a}characters/ghosts/scared_blue.svg`,`${a}characters/ghosts/scared_white.svg`,`${a}pickups/pacdot.svg`,`${a}pickups/powerPellet.svg`,`${a}pickups/apple.svg`,`${a}pickups/bell.svg`,`${a}pickups/cherry.svg`,`${a}pickups/galaxian.svg`,`${a}pickups/key.svg`,`${a}pickups/melon.svg`,`${a}pickups/orange.svg`,`${a}pickups/strawberry.svg`,`${a}text/ready.svg`,`${a}text/100.svg`,`${a}text/200.svg`,`${a}text/300.svg`,`${a}text/400.svg`,`${a}text/500.svg`,`${a}text/700.svg`,`${a}text/800.svg`,`${a}text/1000.svg`,`${a}text/1600.svg`,`${a}text/2000.svg`,`${a}text/3000.svg`,`${a}text/5000.svg`,`${a}maze/maze_blue.svg`,app.config.settings.public_dir+"/vendor/pacman/game/app/style/graphics/extra_life.png"],o=app.config.settings.public_dir+"/vendor/pacman/game/app/style/audio/",h=[`${o}game_start.mp3`,`${o}pause.mp3`,`${o}pause_beat.mp3`,`${o}siren_1.mp3`,`${o}siren_2.mp3`,`${o}siren_3.mp3`,`${o}power_up.mp3`,`${o}extra_life.mp3`,`${o}eyes.mp3`,`${o}eat_ghost.mp3`,`${o}death.mp3`,`${o}fruit.mp3`,`${o}dot_1.mp3`,`${o}dot_2.mp3`],r=n.length+h.length;this.remainingSources=r,i.style.left="0",s.style.width="0",Promise.all([this.createElements(n,"img",r,this),this.createElements(h,"audio",r,this)]).then(()=>{e.style.opacity=0,t(),setTimeout(()=>{e.remove(),this.mainMenu.style.opacity=1,this.mainMenu.style.visibility="visible"},1500)}).catch(this.displayErrorMessage)})}createElements(t,e,i,s){const a=document.getElementById("loading-container"),n=document.getElementById("preload-div"),o=document.getElementById("loading-pacman"),h=a.scrollWidth-o.scrollWidth,r=document.getElementById("loading-dot-mask"),c=s;return new Promise((s,a)=>{let l=0;t.forEach(d=>{const m="img"===e?new Image:new Audio;n.appendChild(m);const p=()=>{c.remainingSources-=1,l+=1;const e=1-c.remainingSources/i;o.style.left=`${e*h}px`,r.style.width=o.style.left,l===t.length&&s()};"img"===e?(m.onload=p,m.onerror=a):(m.addEventListener("canplaythrough",p),m.onerror=a),m.src=d,"audio"===e&&m.load()})})}reset(){this.activeTimers=[],this.points=0,this.level=1,this.lives=2,this.extraLifeGiven=!1,this.remainingDots=0,this.allowKeyPresses=!0,this.allowPacmanMovement=!1,this.allowPause=!1,this.cutscene=!0,this.highScore=localStorage.getItem("highScore"),this.firstGame&&(setInterval(()=>{this.collisionDetectionLoop()},500),this.pacman=new Pacman(this.scaledTileSize,this.mazeArray,new CharacterUtil),this.blinky=new Ghost(this.scaledTileSize,this.mazeArray,this.pacman,"blinky",this.level,new CharacterUtil),this.pinky=new Ghost(this.scaledTileSize,this.mazeArray,this.pacman,"pinky",this.level,new CharacterUtil),this.inky=new Ghost(this.scaledTileSize,this.mazeArray,this.pacman,"inky",this.level,new CharacterUtil,this.blinky),this.clyde=new Ghost(this.scaledTileSize,this.mazeArray,this.pacman,"clyde",this.level,new CharacterUtil),this.fruit=new Pickup("fruit",this.scaledTileSize,13.5,17,this.pacman,this.mazeDiv,100)),this.entityList=[this.pacman,this.blinky,this.pinky,this.inky,this.clyde,this.fruit],this.ghosts=[this.blinky,this.pinky,this.inky,this.clyde],this.scaredGhosts=[],this.eyeGhosts=0,this.firstGame?(this.drawMaze(this.mazeArray,this.entityList),this.soundManager=new SoundManager,this.setUiDimensions()):(this.pacman.reset(),this.ghosts.forEach(t=>{t.reset(!0)}),this.pickups.forEach(t=>{"fruit"!==t.type&&(this.remainingDots+=1,t.reset(),this.entityList.push(t))})),this.pointsDisplay.innerHTML="00",this.highScoreDisplay.innerHTML=this.highScore||"00",this.clearDisplay(this.fruitDisplay);const t=parseInt(localStorage.getItem("volumePreference")||1,10);this.setSoundButtonIcon(t),this.soundManager.setMasterVolume(t)}init(){this.registerEventListeners(),this.gameEngine=new GameEngine(this.maxFps,this.entityList),this.gameEngine.start()}drawMaze(t,e){this.pickups=[this.fruit],this.mazeDiv.style.height=`${31*this.scaledTileSize}px`,this.mazeDiv.style.width=`${28*this.scaledTileSize}px`,this.gameUi.style.width=`${28*this.scaledTileSize}px`,this.bottomRow.style.minHeight=`${2*this.scaledTileSize}px`,this.dotContainer=document.getElementById("dot-container"),t.forEach((t,i)=>{t.forEach((t,s)=>{if("o"===t||"O"===t){const a="o"===t?10:50,n=new Pickup("o"===t?"pacdot":"powerPellet",this.scaledTileSize,s,i,this.pacman,this.dotContainer,a);e.push(n),this.pickups.push(n),this.remainingDots+=1}})})}setUiDimensions(){this.gameUi.style.fontSize=`${this.scaledTileSize}px`,this.rowTop.style.marginBottom=`${this.scaledTileSize}px`}collisionDetectionLoop(){if(this.pacman.position){const t=750*this.pacman.velocityPerMs,e={x:this.pacman.position.left+this.scaledTileSize,y:this.pacman.position.top+this.scaledTileSize},i=!1;this.pickups.forEach(s=>{s.checkPacmanProximity(t,e,i)})}}startGameplay(t){t&&this.soundManager.play("game_start"),this.scaredGhosts=[],this.eyeGhosts=0,this.allowPacmanMovement=!1;const e=11*this.scaledTileSize,i=16.5*this.scaledTileSize,s=t?4500:2e3,a=6*this.scaledTileSize,n=2*this.scaledTileSize;this.displayText({left:e,top:i},"ready",s,a,n),this.updateExtraLivesDisplay(),new Timer(()=>{this.allowPause=!0,this.cutscene=!1,this.soundManager.setCutscene(this.cutscene),this.soundManager.setAmbience(this.determineSiren(this.remainingDots)),this.allowPacmanMovement=!0,this.pacman.moving=!0,this.ghosts.forEach(t=>{t.moving=!0}),this.ghostCycle("scatter"),this.idleGhosts=[this.pinky,this.inky,this.clyde],this.releaseGhost()},s)}clearDisplay(t){for(;t.firstChild;)t.removeChild(t.firstChild)}updateExtraLivesDisplay(){this.clearDisplay(this.extraLivesDisplay);for(let t=0;t<this.lives;t+=1){const t=document.createElement("img");t.setAttribute("src",app.config.settings.public_dir+"/vendor/pacman/game/app/style/graphics/extra_life.svg"),t.style.height=`${2*this.scaledTileSize}px`,this.extraLivesDisplay.appendChild(t)}}updateFruitDisplay(t){const e=t.slice(t.indexOf("(")+1,t.indexOf(")"));7===this.fruitDisplay.children.length&&this.fruitDisplay.removeChild(this.fruitDisplay.firstChild);const i=document.createElement("img");i.setAttribute("src",e),i.style.height=`${2*this.scaledTileSize}px`,this.fruitDisplay.appendChild(i)}ghostCycle(t){const e="scatter"===t?7e3:2e4,i="scatter"===t?"chase":"scatter";this.ghostCycleTimer=new Timer(()=>{this.ghosts.forEach(t=>{t.changeMode(i)}),this.ghostCycle(i)},e)}releaseGhost(){if(this.idleGhosts.length>0){const t=Math.max(1e3*(8-4*(this.level-1)),0);this.endIdleTimer=new Timer(()=>{this.idleGhosts[0].endIdleMode(),this.idleGhosts.shift()},t)}}registerEventListeners(){window.addEventListener("keydown",this.handleKeyDown.bind(this)),window.addEventListener("awardPoints",this.awardPoints.bind(this)),window.addEventListener("deathSequence",this.deathSequence.bind(this)),window.addEventListener("dotEaten",this.dotEaten.bind(this)),window.addEventListener("powerUp",this.powerUp.bind(this)),window.addEventListener("eatGhost",this.eatGhost.bind(this)),window.addEventListener("restoreGhost",this.restoreGhost.bind(this)),window.addEventListener("addTimer",this.addTimer.bind(this)),window.addEventListener("removeTimer",this.removeTimer.bind(this)),window.addEventListener("releaseGhost",this.releaseGhost.bind(this));["up","down","left","right"].forEach(t=>{document.getElementById(`button-${t}`).addEventListener("touchstart",()=>{this.changeDirection(t)})})}changeDirection(t){this.allowKeyPresses&&this.gameEngine.running&&this.pacman.changeDirection(t,this.allowPacmanMovement)}handleKeyDown(t){27===t.keyCode?this.handlePauseKey():81===t.keyCode?this.soundButtonClick():this.movementKeys[t.keyCode]&&this.changeDirection(this.movementKeys[t.keyCode])}handlePauseKey(){this.allowPause&&(this.allowPause=!1,setTimeout(()=>{this.cutscene||(this.allowPause=!0)},500),this.gameEngine.changePausedState(this.gameEngine.running),this.soundManager.play("pause"),this.gameEngine.started?(this.soundManager.resumeAmbience(),this.gameUi.style.filter="unset",this.movementButtons.style.filter="unset",this.pausedText.style.visibility="hidden",this.pauseButton.innerHTML="pause",this.activeTimers.forEach(t=>{t.resume()})):(this.soundManager.stopAmbience(),this.soundManager.setAmbience("pause_beat",!0),this.gameUi.style.filter="blur(5px)",this.movementButtons.style.filter="blur(5px)",this.pausedText.style.visibility="visible",this.pauseButton.innerHTML="play_arrow",this.activeTimers.forEach(t=>{t.pause()})))}awardPoints(t){if(this.points+=t.detail.points,this.pointsDisplay.innerText=this.points,this.points>(this.highScore||0)&&(this.highScore=this.points,this.highScoreDisplay.innerText=this.points,localStorage.setItem("highScore",this.highScore)),this.points>=1e4&&!this.extraLifeGiven&&(this.extraLifeGiven=!0,this.soundManager.play("extra_life"),this.lives+=1,this.updateExtraLivesDisplay()),"fruit"===t.detail.type){const e=t.detail.points>=1e3?12.5*this.scaledTileSize:13*this.scaledTileSize,i=16.5*this.scaledTileSize,s=t.detail.points>=1e3?3*this.scaledTileSize:2*this.scaledTileSize,a=2*this.scaledTileSize;this.displayText({left:e,top:i},t.detail.points,2e3,s,a),this.soundManager.play("fruit"),this.updateFruitDisplay(this.fruit.determineImage("fruit",t.detail.points))}}deathSequence(){this.allowPause=!1,this.cutscene=!0,this.soundManager.setCutscene(this.cutscene),this.soundManager.stopAmbience(),this.removeTimer({detail:{timer:this.fruitTimer}}),this.removeTimer({detail:{timer:this.ghostCycleTimer}}),this.removeTimer({detail:{timer:this.endIdleTimer}}),this.removeTimer({detail:{timer:this.ghostFlashTimer}}),this.allowKeyPresses=!1,this.pacman.moving=!1,this.ghosts.forEach(t=>{t.moving=!1}),new Timer(()=>{this.ghosts.forEach(t=>{t.display=!1}),this.pacman.prepDeathAnimation(),this.soundManager.play("death"),this.lives>0?(this.lives-=1,new Timer(()=>{this.mazeCover.style.visibility="visible",new Timer(()=>{this.allowKeyPresses=!0,this.mazeCover.style.visibility="hidden",this.pacman.reset(),this.ghosts.forEach(t=>{t.reset()}),this.fruit.hideFruit(),this.startGameplay()},500)},2250)):this.gameOver()},750)}gameOver(){localStorage.setItem("highScore",this.highScore),new Timer(()=>{this.displayText({left:9*this.scaledTileSize,top:16.5*this.scaledTileSize},"game_over",4e3,10*this.scaledTileSize,2*this.scaledTileSize),this.fruit.hideFruit(),new Timer(()=>{this.leftCover.style.left="0",this.rightCover.style.right="0",setTimeout(()=>{this.mainMenu.style.opacity=1,this.gameStartButton.disabled=!1,this.mainMenu.style.visibility="visible"},1e3)},2500)},2250)}dotEaten(){this.remainingDots-=1,this.soundManager.playDotSound(),174!==this.remainingDots&&74!==this.remainingDots||this.createFruit(),40!==this.remainingDots&&20!==this.remainingDots||this.speedUpBlinky(),0===this.remainingDots&&this.advanceLevel()}createFruit(){this.removeTimer({detail:{timer:this.fruitTimer}}),this.fruit.showFruit(this.fruitPoints[this.level]||5e3),this.fruitTimer=new Timer(()=>{this.fruit.hideFruit()},1e4)}speedUpBlinky(){this.blinky.speedUp(),0===this.scaredGhosts.length&&0===this.eyeGhosts&&this.soundManager.setAmbience(this.determineSiren(this.remainingDots))}determineSiren(t){let e;return`siren_${e=t>40?1:t>20?2:3}`}advanceLevel(){this.allowPause=!1,this.cutscene=!0,this.soundManager.setCutscene(this.cutscene),this.allowKeyPresses=!1,this.soundManager.stopAmbience(),this.entityList.forEach(t=>{t.moving=!1}),this.removeTimer({detail:{timer:this.fruitTimer}}),this.removeTimer({detail:{timer:this.ghostCycleTimer}}),this.removeTimer({detail:{timer:this.endIdleTimer}}),this.removeTimer({detail:{timer:this.ghostFlashTimer}});const t=app.config.settings.public_dir+"/vendor/pacman/game/app/style//graphics/spriteSheets/maze/";new Timer(()=>{this.ghosts.forEach(t=>{t.display=!1}),this.mazeImg.src=`${t}maze_white.svg`,new Timer(()=>{this.mazeImg.src=`${t}maze_blue.svg`,new Timer(()=>{this.mazeImg.src=`${t}maze_white.svg`,new Timer(()=>{this.mazeImg.src=`${t}maze_blue.svg`,new Timer(()=>{this.mazeImg.src=`${t}maze_white.svg`,new Timer(()=>{this.mazeImg.src=`${t}maze_blue.svg`,new Timer(()=>{this.mazeCover.style.visibility="visible",new Timer(()=>{this.mazeCover.style.visibility="hidden",this.level+=1,this.allowKeyPresses=!0,this.entityList.forEach(t=>{const e=t;e.level&&(e.level=this.level),e.reset(),e instanceof Ghost&&e.resetDefaultSpeed(),e instanceof Pickup&&"fruit"!==e.type&&(this.remainingDots+=1)}),this.startGameplay()},500)},250)},250)},250)},250)},250)},250)},2e3)}flashGhosts(t,e){t===e?(this.scaredGhosts.forEach(t=>{t.endScared()}),this.scaredGhosts=[],0===this.eyeGhosts&&this.soundManager.setAmbience(this.determineSiren(this.remainingDots))):this.scaredGhosts.length>0&&(this.scaredGhosts.forEach(t=>{t.toggleScaredColor()}),this.ghostFlashTimer=new Timer(()=>{this.flashGhosts(t+1,e)},250))}powerUp(){0!==this.remainingDots&&this.soundManager.setAmbience("power_up"),this.removeTimer({detail:{timer:this.ghostFlashTimer}}),this.ghostCombo=0,this.scaredGhosts=[],this.ghosts.forEach(t=>{"eyes"!==t.mode&&this.scaredGhosts.push(t)}),this.scaredGhosts.forEach(t=>{t.becomeScared()});const t=Math.max(1e3*(7-this.level),0);this.ghostFlashTimer=new Timer(()=>{this.flashGhosts(0,9)},t)}determineComboPoints(){return 100*2**this.ghostCombo}eatGhost(t){const{position:e,measurement:i}=t.detail.ghost;this.pauseTimer({detail:{timer:this.ghostFlashTimer}}),this.pauseTimer({detail:{timer:this.ghostCycleTimer}}),this.pauseTimer({detail:{timer:this.fruitTimer}}),this.soundManager.play("eat_ghost"),this.scaredGhosts=this.scaredGhosts.filter(e=>e.name!==t.detail.ghost.name),this.eyeGhosts+=1,this.ghostCombo+=1;const s=this.determineComboPoints();window.dispatchEvent(new CustomEvent("awardPoints",{detail:{points:s}})),this.displayText(e,s,1e3,i),this.allowPacmanMovement=!1,this.pacman.display=!1,this.pacman.moving=!1,t.detail.ghost.display=!1,t.detail.ghost.moving=!1,this.ghosts.forEach(t=>{const e=t;e.animate=!1,e.pause(!0),e.allowCollision=!1}),new Timer(()=>{this.soundManager.setAmbience("eyes"),this.resumeTimer({detail:{timer:this.ghostFlashTimer}}),this.resumeTimer({detail:{timer:this.ghostCycleTimer}}),this.resumeTimer({detail:{timer:this.fruitTimer}}),this.allowPacmanMovement=!0,this.pacman.display=!0,this.pacman.moving=!0,t.detail.ghost.display=!0,t.detail.ghost.moving=!0,this.ghosts.forEach(t=>{const e=t;e.animate=!0,e.pause(!1),e.allowCollision=!0})},1e3)}restoreGhost(){if(this.eyeGhosts-=1,0===this.eyeGhosts){const t=this.scaredGhosts.length>0?"power_up":this.determineSiren(this.remainingDots);this.soundManager.setAmbience(t)}}displayText(t,e,i,s,a){const n=document.createElement("div");n.style.position="absolute",n.style.backgroundSize=`${s}px`,n.style.backgroundImage="url("+app.config.settings.public_dir+"/vendor/pacman/game/app/style/graphics/"+`spriteSheets/text/${e}.svg`,n.style.width=`${s}px`,n.style.height=`${a||s}px`,n.style.top=`${t.top}px`,n.style.left=`${t.left}px`,n.style.zIndex=2,this.mazeDiv.appendChild(n),new Timer(()=>{this.mazeDiv.removeChild(n)},i)}addTimer(t){this.activeTimers.push(t.detail.timer)}timerExists(t){return!!(t.detail.timer||{}).timerId}pauseTimer(t){this.timerExists(t)&&t.detail.timer.pause(!0)}resumeTimer(t){this.timerExists(t)&&t.detail.timer.resume(!0)}removeTimer(t){this.timerExists(t)&&(window.clearTimeout(t.detail.timer.timerId),this.activeTimers=this.activeTimers.filter(e=>e.timerId!==t.detail.timer.timerId))}}class GameEngine{constructor(t,e){this.fpsDisplay=document.getElementById("fps-display"),this.elapsedMs=0,this.lastFrameTimeMs=0,this.entityList=e,this.maxFps=t,this.timestep=1e3/this.maxFps,this.fps=this.maxFps,this.framesThisSecond=0,this.lastFpsUpdate=0,this.frameId=0,this.running=!1,this.started=!1}changePausedState(t){t?this.stop():this.start()}updateFpsDisplay(t){t>this.lastFpsUpdate+1e3&&(this.fps=(this.framesThisSecond+this.fps)/2,this.lastFpsUpdate=t,this.framesThisSecond=0),this.framesThisSecond+=1,this.fpsDisplay.textContent=`${Math.round(this.fps)} FPS`}draw(t,e){e.forEach(e=>{"function"==typeof e.draw&&e.draw(t)})}update(t,e){e.forEach(e=>{"function"==typeof e.update&&e.update(t)})}panic(){this.elapsedMs=0}start(){this.started||(this.started=!0,this.frameId=requestAnimationFrame(t=>{this.draw(1,[]),this.running=!0,this.lastFrameTimeMs=t,this.lastFpsUpdate=t,this.framesThisSecond=0,this.frameId=requestAnimationFrame(t=>{this.mainLoop(t)})}))}stop(){this.running=!1,this.started=!1,cancelAnimationFrame(this.frameId)}processFrames(){let t=0;for(;this.elapsedMs>=this.timestep;)if(this.update(this.timestep,this.entityList),this.elapsedMs-=this.timestep,(t+=1)>=this.maxFps){this.panic();break}}engineCycle(t){t<this.lastFrameTimeMs+1e3/this.maxFps?this.frameId=requestAnimationFrame(t=>{this.mainLoop(t)}):(this.elapsedMs+=t-this.lastFrameTimeMs,this.lastFrameTimeMs=t,this.updateFpsDisplay(t),this.processFrames(),this.draw(this.elapsedMs/this.timestep,this.entityList),this.frameId=requestAnimationFrame(t=>{this.mainLoop(t)}))}mainLoop(t){this.engineCycle(t)}}class Pickup{constructor(t,e,i,s,a,n,o){this.type=t,this.pacman=a,this.mazeDiv=n,this.points=o,this.nearPacman=!1,this.fruitImages={100:"cherry",300:"strawberry",500:"orange",700:"apple",1000:"melon",2000:"galaxian",3000:"bell",5000:"key"},this.setStyleMeasurements(t,e,i,s,o)}reset(){this.animationTarget.style.visibility="fruit"===this.type?"hidden":"visible"}setStyleMeasurements(t,e,i,s,a){"pacdot"===t?(this.size=.25*e,this.x=i*e+e/8*3,this.y=s*e+e/8*3):"powerPellet"===t?(this.size=e,this.x=i*e,this.y=s*e):(this.size=2*e,this.x=i*e-.5*e,this.y=s*e-.5*e),this.center={x:i*e,y:s*e},this.animationTarget=document.createElement("div"),this.animationTarget.style.position="absolute",this.animationTarget.style.backgroundSize=`${this.size}px`,this.animationTarget.style.backgroundImage=this.determineImage(t,a),this.animationTarget.style.height=`${this.size}px`,this.animationTarget.style.width=`${this.size}px`,this.animationTarget.style.top=`${this.y}px`,this.animationTarget.style.left=`${this.x}px`,this.mazeDiv.appendChild(this.animationTarget),"powerPellet"===t&&this.animationTarget.classList.add("power-pellet"),this.reset()}determineImage(t,e){let i="";return i="fruit"===t?this.fruitImages[e]||"cherry":t,`url(${app.config.settings.public_dir}/vendor/pacman/game/app/style/graphics/spriteSheets/pickups/${i}.svg)`}showFruit(t){this.points=t,this.animationTarget.style.backgroundImage=this.determineImage(this.type,t),this.animationTarget.style.visibility="visible"}hideFruit(){this.animationTarget.style.visibility="hidden"}checkForCollision(t,e){const i=Object.assign({},e);return i.x+=.25*i.size,i.y+=.25*i.size,i.size/=2,t.x<i.x+i.size&&t.x+t.size>i.x&&t.y<i.y+i.size&&t.y+t.size>i.y}checkPacmanProximity(t,e,i){if("hidden"!==this.animationTarget.style.visibility){const s=Math.sqrt((this.center.x-e.x)**2+(this.center.y-e.y)**2);this.nearPacman=s<=t,i&&(this.animationTarget.style.background=this.nearPacman?"lime":"red")}}shouldCheckForCollision(){return"hidden"!==this.animationTarget.style.visibility&&this.nearPacman}update(){this.shouldCheckForCollision()&&this.checkForCollision({x:this.x,y:this.y,size:this.size},{x:this.pacman.position.left,y:this.pacman.position.top,size:this.pacman.measurement})&&(this.animationTarget.style.visibility="hidden",window.dispatchEvent(new CustomEvent("awardPoints",{detail:{points:this.points,type:this.type}})),"pacdot"===this.type?window.dispatchEvent(new Event("dotEaten")):"powerPellet"===this.type&&(window.dispatchEvent(new Event("dotEaten")),window.dispatchEvent(new Event("powerUp"))))}}class CharacterUtil{constructor(){this.directions={up:"up",down:"down",left:"left",right:"right"}}checkForStutter(t,e){let i=!1;return t&&e&&(Math.abs(t.top-e.top)>5||Math.abs(t.left-e.left)>5)&&(i=!0),i?"hidden":"visible"}getPropertyToChange(t){switch(t){case this.directions.up:case this.directions.down:return"top";default:return"left"}}getVelocity(t,e){switch(t){case this.directions.up:case this.directions.left:return-1*e;default:return e}}calculateNewDrawValue(t,e,i,s){return i[e]+(s[e]-i[e])*t}determineGridPosition(t,e){return{x:t.left/e+.5,y:t.top/e+.5}}turningAround(t,e){return e===this.getOppositeDirection(t)}getOppositeDirection(t){switch(t){case this.directions.up:return this.directions.down;case this.directions.down:return this.directions.up;case this.directions.left:return this.directions.right;default:return this.directions.left}}determineRoundingFunction(t){switch(t){case this.directions.up:case this.directions.left:return Math.floor;default:return Math.ceil}}changingGridPosition(t,e){return Math.floor(t.x)!==Math.floor(e.x)||Math.floor(t.y)!==Math.floor(e.y)}checkForWallCollision(t,e,i){const s=this.determineRoundingFunction(i,this.directions),a=s(t.x),n=s(t.y);let o;return Array.isArray(e[n])&&(o=e[n][a]),"X"===o}determineNewPositions(t,e,i,s,a){const n=Object.assign({},t);return n[this.getPropertyToChange(e)]+=this.getVelocity(e,i)*s,{newPosition:n,newGridPosition:this.determineGridPosition(n,a)}}snapToGrid(t,e,i){const s=Object.assign({},t),a=this.determineRoundingFunction(e,this.directions);switch(e){case this.directions.up:case this.directions.down:s.y=a(s.y);break;default:s.x=a(s.x)}return{top:(s.y-.5)*i,left:(s.x-.5)*i}}handleWarp(t,e,i){const s=Object.assign({},t),a=this.determineGridPosition(t,e);return a.x<-.75?s.left=e*(i[0].length-.75):a.x>i[0].length-.25&&(s.left=-1.25*e),s}advanceSpriteSheet(t){const{msSinceLastSprite:e,animationTarget:i,backgroundOffsetPixels:s}=t,a={msSinceLastSprite:e,animationTarget:i,backgroundOffsetPixels:s};if(t.msSinceLastSprite>t.msBetweenSprites&&t.animate){a.msSinceLastSprite=0,t.backgroundOffsetPixels<t.measurement*(t.spriteFrames-1)?a.backgroundOffsetPixels+=t.measurement:t.loopAnimation&&(a.backgroundOffsetPixels=0);const e=`-${a.backgroundOffsetPixels}px 0px`;a.animationTarget.style.backgroundPosition=e}return a}}class SoundManager{constructor(){this.baseUrl=app.config.settings.public_dir+"/vendor/pacman/game/app/style/audio/",this.fileFormat="mp3",this.masterVolume=1,this.paused=!1,this.cutscene=!0;const t=window.AudioContext||window.webkitAudioContext;this.ambience=new t}setCutscene(t){this.cutscene=t}setMasterVolume(t){this.masterVolume=t,this.soundEffect&&(this.soundEffect.volume=this.masterVolume),this.dotPlayer&&(this.dotPlayer.volume=this.masterVolume),0===this.masterVolume?this.stopAmbience():this.resumeAmbience(this.paused)}play(t){this.soundEffect=new Audio(`${this.baseUrl}${t}.${this.fileFormat}`),this.soundEffect.volume=this.masterVolume,this.soundEffect.play()}playDotSound(){this.queuedDotSound=!0,this.dotPlayer||(this.queuedDotSound=!1,this.dotSound=1===this.dotSound?2:1,this.dotPlayer=new Audio(`${this.baseUrl}dot_${this.dotSound}.${this.fileFormat}`),this.dotPlayer.onended=this.dotSoundEnded.bind(this),this.dotPlayer.volume=this.masterVolume,this.dotPlayer.play())}dotSoundEnded(){this.dotPlayer=void 0,this.queuedDotSound&&this.playDotSound()}async setAmbience(t,e){if(!this.fetchingAmbience&&!this.cutscene&&(e?this.paused=!0:(this.currentAmbience=t,this.paused=!1),this.ambienceSource&&this.ambienceSource.stop(),0!==this.masterVolume)){this.fetchingAmbience=!0;const e=await fetch(`${this.baseUrl}${t}.${this.fileFormat}`),i=await e.arrayBuffer(),s=await this.ambience.decodeAudioData(i);this.ambienceSource=this.ambience.createBufferSource(),this.ambienceSource.buffer=s,this.ambienceSource.connect(this.ambience.destination),this.ambienceSource.loop=!0,this.ambienceSource.start(),this.fetchingAmbience=!1}}resumeAmbience(t){this.ambienceSource&&(t?this.setAmbience("pause_beat",!0):this.setAmbience(this.currentAmbience))}stopAmbience(){this.ambienceSource&&this.ambienceSource.stop()}}class Timer{constructor(t,e){this.callback=t,this.remaining=e,this.resume()}pause(t){window.clearTimeout(this.timerId),this.remaining-=new Date-this.start,this.oldTimerId=this.timerId,t&&(this.pausedBySystem=!0)}resume(t){!t&&this.pausedBySystem||(this.pausedBySystem=!1,this.start=new Date,this.timerId=window.setTimeout(()=>{this.callback(),window.dispatchEvent(new CustomEvent("removeTimer",{detail:{timer:this}}))},this.remaining),this.oldTimerId||window.dispatchEvent(new CustomEvent("addTimer",{detail:{timer:this}})))}}